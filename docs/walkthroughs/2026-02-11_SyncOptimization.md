# Toggl2Notion 同步优化总结

## 变更说明

### 1. 鲁棒性增强 (Resilience)
- **处理缺失属性**: 在 `notion_helper.py` 中增加了全面的容错处理。如果 Notion 数据库中缺失 `Id` 属性，脚本现在会记录警告并自动回退（Fallback）到基于名称的匹配，而不再直接崩溃。
- **大小写不敏感匹配**: 对 Notion API 返回的报错信息进行了大小写不敏感匹配，确保在各种环境下都能准确捕获属性缺失错误。

### 2. 展示逻辑优化 (UI/UX)
- **标题显示**: 优先显示任务的“描述”（Description）。如果任务没有描述，则显示项目名称。
- **图标展示**: 自动从项目名称中提取 Emoji 并将其设置为 Notion 页面的图标。

### 3. 同步中断优化 (Anti-Flooding)
- **智能停止**: 针对 Toggl 免费版 API 的限制（如 90 天历史限制），脚本在遇到 **HTTP 400** 或 **HTTP 402** 报错时会自动记录原因并立即**停止历史同步循环**。
- **解决刷屏**: 彻底解决了之前脚本因为不断尝试无法获取的旧数据而导致的持续报错刷屏问题。

### 4. 代码结构精简
- **清理冗余**: 删除了 `toggl.py` 中重复的 `init()` 函数。
- **完善认证**: 确保所有 API 请求都使用统一的认证逻辑。

## 修改文件列表
- `toggl2notion/notion_helper.py`: 核心容错与属性回退逻辑。
- `toggl2notion/toggl.py`: 同步控制逻辑、标题/图标处理、循环中断优化。
- `toggl2notion/config.py`: 默认属性映射定义。

---
*注：建议为 Notion 的“时间记录”主数据库也增加一个 `Id` 属性（Number 类型），以获得最佳的排重效果。*
